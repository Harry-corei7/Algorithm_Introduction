`难度：困难`

- 给你一个字符串表达式`s`，请你实现一个基本计算器来计算并返回它的值。
- 注意:不允许使用任何将字符串作为数学表达式计算的内置函数，比如`eval()`。

- 示例 1：
  - 输入：s = "1 + 1"
  - 输出：2
- 示例 2：
  - 输入：s = " 2-1 + 2 "
  - 输出：3
- 示例 3：
  - 输入：s = "(1+(4+5+2)-3)+(6+8)"
  - 输出：23
---
`python语法：双栈法，使用isdigit()判断数字`
```python
class Solution(object):
    def __init__(self):
        # 定义运算符优先级
        self.op_prioirty = {'-': 1, '+': 1, '*': 2, '/': 2, '%': 2, '^': 3}
        # 储存数字的栈
        self.num_stack = []
        # 储存操作符的栈
        self.op_stack = []


    def calc(self):
        # 计算两个操作数的结果
        if(len(self.num_stack) < 2 or len(self.op_stack) == 0):
            return 
        
        b = self.num_stack.pop()
        a = self.num_stack.pop()
        op = self.op_stack.pop()

        if(op == '+'):
            res = a + b
        elif(op == '-'):
            res = a - b
        elif(op == '*'):
            res = a * b
        elif(op == '/'):
            res = int(a / b) # 使用整数除法，等同于a//b
        elif(op == '^'):
            res = int(a ** b) # 使用幂运算，并将结果转整数
        elif(op == '%'):
            res = a % b
        
        # 将计算结果压入栈中
        self.num_stack.append(res)
        

    def calculate(self, s):
        """
        :type s: str
        :rtype: int
        """
        # 去掉所有空格
        s = s.replace(" ", "") # 将字符串所有" "去除
        n = len(s)
        i = 0
        while(i < n):
            ch = s[i]

            if(ch == '('): # 遇到左括号，压栈
                self.op_stack.append(ch)
            elif(ch == ')'): # 遇到右括号，计算直到遇到左括号
                while(self.op_stack[-1] != '('):
                    self.calc()
                self.op_stack.pop() # 弹出'('
            elif(ch.isdigit()): 
                # .isdigit()表示这个字符串只有数字
                # 考虑多位数
                num = 0
                while(i < n and s[i].isdigit()):
                    num = num * 10 +int(s[i])
                    i += 1
                self.num_stack.append(num)
                continue # 跳过循环中的 i + 1，因为已经处理了数字
            else: 
                # 遇到运算符，处理优先级
                if((ch == '-') and (i == 0 or s[i - 1] == '(')):
                    self.num_stack.append(0)
                
                # 先将栈内的'优先级'更高/同等的运算符，进行计算，然后再将当前运算符入栈
                while(self.op_stack and self.op_stack[-1] != '(' and 
                    self.op_prioirty[self.op_stack[-1]] >= self.op_prioirty[ch]):
                    self.calc()

                # 将当前运算符入栈
                self.op_stack.append(ch)
            
            i += 1
        
        # 预处理完括号和优先级高的运算符，继续计算栈中剩余的运算符
        while(self.op_stack):
            self.calc()
        
        # 返回最终结果
        return self.num_stack[-1]
```
